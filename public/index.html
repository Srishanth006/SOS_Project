<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emergency SOS</title>
    <style>
        /* Global styles */
        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            text-align: center;
            background: #111827; /* Dark blue-gray background */
            color: #f9fafb;
        }

        /* Main container for the SOS card */
        .container {
            background: #1f2937;
            border-radius: 16px;
            padding: 2rem 1.5rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.2), 0 10px 10px -5px rgba(0,0,0,0.1);
            border: 1px solid #374151;
        }

        /* Title styling */
        h1 {
            margin: 0 0 0.5rem;
            font-size: 1.8rem;
            color: #ef4444; /* Bright red for emergency */
        }

        /* Subtitle/instruction text */
        p.subtitle {
            margin: 0 0 2rem;
            color: #9ca3af;
            line-height: 1.5;
        }

        /* The main SOS button */
        .sos-button {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: none;
            background: #ef4444;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.4);
        }
        .sos-button:hover { background: #dc2626; }
        .sos-button:disabled { cursor: not-allowed; }

        /* Pulsing animation when SOS is active */
        .sos-button.active {
            animation: pulse 2s infinite;
            background: #dc2626;
        }

        /* The "Stop Sharing" button */
        .stop-button {
            background: none;
            border: 1px solid #4b5563;
            color: #9ca3af;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1.5rem;
            display: none; /* Hidden by default */
        }

        /* Status message text */
        .status { margin-top: 1.5rem; min-height: 1.2rem; font-weight: 500; }
        .status.ok { color: #22c55e; } /* Green for success */
        .status.err { color: #f87171; } /* Red for error */

        /* Pulsing animation keyframes */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Emergency SOS</h1>
        <p class="subtitle">Press the button below to send your live location to the authorities. Stay on this page.</p>
        <button id="sosButton" class="sos-button">SOS</button>
        <button id="stopBtn" class="stop-button">Stop Sharing</button>
        <div id="status" class="status">Press SOS in an emergency.</div>
    </div>

    <!-- Firebase SDKs from the public CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // --- Your Firebase Configuration ---
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDJG7XujjzGVGrdiDzYjPgdw34mFw6mkIA",
            authDomain: "alert-system-a99ab.firebaseapp.com",
            databaseURL: "https://alert-system-a99ab-default-rtdb.firebaseio.com",
            projectId: "alert-system-a99ab",
            storageBucket: "alert-system-a99ab.firebasestorage.app",
            messagingSenderId: "301074962948",
            appId: "1:301074962948:web:a32821f6312145e1627351",
            measurementId: "G-0C5EPXJGED"
        };
        // ------------------------------------
        
        // Initialize Firebase
        const app = firebase.initializeApp(FIREBASE_CONFIG);
        const db = firebase.database();
        const baseRef = db.ref('sos_reports');

        // Get references to UI elements
        const statusEl = document.getElementById('status');
        const sosButton = document.getElementById('sosButton');
        const stopBtn = document.getElementById('stopBtn');

        // State variables
        let reportKey = null;
        let watchId = null;

        function setStatus(msg, cls){ statusEl.textContent = msg; statusEl.className = 'status ' + (cls||''); }

        function startSOS() {
            setStatus('Requesting location...', '');
            sosButton.disabled = true;

            navigator.geolocation.getCurrentPosition(async (pos) => {
                const initial = { createdAt: new Date().toISOString(), location: { lat: pos.coords.latitude, lng: pos.coords.longitude, accuracy: pos.coords.accuracy } };
                try {
                    const ref = baseRef.push();
                    await ref.set(initial);
                    reportKey = ref.key;
                    setStatus('SOS Active. Sharing location.', 'ok');
                    sosButton.classList.add('active');
                    sosButton.innerHTML = 'ACTIVE';
                    stopBtn.style.display = 'inline-block';
                    startWatch();
                } catch(e) { 
                    setStatus('Could not send SOS. Check connection.', 'err'); 
                    sosButton.disabled = false;
                }
            }, (err) => {
                let msg = 'Could not get location.'; 
                if (err.code === 1) msg = 'Location permission denied.'; 
                setStatus(msg, 'err'); 
                sosButton.disabled = false;
            }, { enableHighAccuracy: true, timeout: 20000, maximumAge: 0 });
        }
        
        function startWatch() {
            watchId = navigator.geolocation.watchPosition(pos => {
                if (!reportKey) return;
                baseRef.child(reportKey).update({ 
                    location: { lat: pos.coords.latitude, lng: pos.coords.longitude, accuracy: pos.coords.accuracy }, 
                    updatedAt: new Date().toISOString() 
                });
            }, null, { enableHighAccuracy: true });
        }
        
        function stopSOS() {
            if (watchId !== null) navigator.geolocation.clearWatch(watchId);
            watchId = null; 
            reportKey = null;
            setStatus('SOS stopped. Location is no longer shared.');
            sosButton.disabled = false;
            sosButton.classList.remove('active');
            sosButton.innerHTML = 'SOS';
            stopBtn.style.display = 'none';
        }

        sosButton.addEventListener('click', () => { if (!reportKey) startSOS(); });
        stopBtn.addEventListener('click', stopSOS);
    </script>
</body>
</html>