<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Women's Safety Dashboard & Resources</title>
    <!-- The stylesheet link remains the same -->
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
</head>
<body>
    <!-- New Background Video and Overlay -->
    <div class="video-overlay"></div>
    <video class="background-video" autoplay loop muted playsinline>
        <!-- Royalty-free video from Pexels -->
        <source src="https://videos.pexels.com/video-files/4781403/4781403-hd_1920_1080_25fps.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <div class="main-content">
        <header class="app-header">
            <h1>Women's Safety Dashboard</h1>
            <div class="alert-banner" id="alertBanner" style="display:none;">
                <span class="badge" id="alertCount">0</span>
                ACTIVE SOS ALERT
            </div>
        </header>

        <!-- New 3-Column Grid Layout -->
        <main class="dashboard-grid">
            
            <!-- Left Column: Resources -->
            <section class="resource-panel">
                <h2>Empowerment Resources</h2>
                
                <div class="dropdown-container">
                    <button class="dropdown-button">Self-Defense Videos</button>
                    <div class="dropdown-content">
                        <a href="https://www.youtube.com/shorts/bhv-d_GY99M" target="_blank">Basic Hold Defenses</a>
                        <a href="https://www.youtube.com/watch?v=912cwgHe_gE" target="_blank">Wrist Grab Escapes</a>
                        <a href="https://www.youtube.com/watch?v=M4_CB1c--J0" target="_blank">Basic Self-Defense Moves</a>
                    </div>
                </div>

                <div class="dropdown-container">
                    <button class="dropdown-button">Know Your Rights</button>
                    <div class="dropdown-content">
                        <a href="https://ncw.nic.in/important-links/legal-provisions-women" target="_blank">National Commission for Women (India)</a>
                        <a href="https://www.unwomen.org/en/what-we-do/ending-violence-against-women/facts-and-figures" target="_blank">UN Women - Facts & Figures</a>
                    </div>
                </div>
            </section>

            <!-- Center Column: Map and SOS Reports -->
            <section class="main-dashboard-panel">
                <div id="map" class="map"></div>
                <div class="panel reports-panel">
                     <div class="panel-header">
                        <h2>Incoming Reports</h2>
                        <button id="clearButton" class="btn">Clear All</button>
                    </div>
                    <div class="list" id="reportList"></div>
                </div>
            </section>

            <!-- Right Column: Helplines -->
            <section class="resource-panel">
                <h2>Helplines & Support</h2>
                <div class="dropdown-container">
                    <button class="dropdown-button">National Helplines (India)</button>
                    <div class="dropdown-content">
                        <p>Women Helpline: <strong>1091</strong></p>
                        <p>Domestic Abuse: <strong>181</strong></p>
                        <p>Police: <strong>112</strong></p>
                    </div>
                </div>
                 <div class="dropdown-container">
                    <button class="dropdown-button">Mental Health Support</button>
                    <div class="dropdown-content">
                        <a href="https://www.nimhans.ac.in/" target="_blank">NIMHANS</a>
                        <a href="https://www.vandrevalafoundation.com/" target="_blank">Vandrevala Foundation</a>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Sound for new alerts (unchanged) -->
    <audio id="alertSound" preload="auto">
        <source src="https://www.zapsplat.com/wp-content/uploads/2015/sound-effects-the-sound-pack-tree/tspt_siren_short_burst_01.mp3" type="audio/mpeg" />
    </audio>

    <!-- JS Libraries (unchanged) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <script>
        // NEW JAVASCRIPT FOR DROPDOWNS
        document.addEventListener('DOMContentLoaded', () => {
            const dropdownButtons = document.querySelectorAll('.dropdown-button');
            dropdownButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const content = button.nextElementSibling;
                    content.classList.toggle('show');
                });
            });
        });

        // --- YOUR FIREBASE BACKEND CODE (ENTIRELY UNCHANGED) ---
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyDJG7XujjzGVGrdiDzYjPgdw34mFw6mkIA",
            authDomain: "alert-system-a99ab.firebaseapp.com",
            databaseURL: "https://alert-system-a99ab-default-rtdb.firebaseio.com",
            projectId: "alert-system-a99ab",
            storageBucket: "alert-system-a99ab.firebasestorage.app",
            messagingSenderId: "301074962948",
            appId: "1:301074962948:web:a32821f6312145e1627351",
            measurementId: "G-0C5EPXJGED"
        };
        const app = firebase.initializeApp(FIREBASE_CONFIG);
        const db = firebase.database();
        const reportsRef = db.ref('sos_reports');
        const reportList = document.getElementById('reportList');
        const alertBanner = document.getElementById('alertBanner');
        const alertCount = document.getElementById('alertCount');
        const clearButton = document.getElementById('clearButton');
        const alertSound = document.getElementById('alertSound');
        const map = L.map('map').setView([11.1271, 78.6569], 7); // Center on Tamil Nadu
        const markers = {};
        const accuracyCircles = {};
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap' }).addTo(map);
        
        // All your functions (playSound, updateUI) and Firebase listeners (reportsRef.on)
        // are still here and will work exactly as before. They are omitted for brevity in this comment
        // but are present in the full code block you should copy.
        function playSound() { alertSound.play().catch(error => console.log("Audio play blocked.", error)); }
        function updateUI() { const reportCount = Object.keys(markers).length; alertCount.textContent = reportCount; alertBanner.style.display = reportCount > 0 ? 'flex' : 'none'; }
        reportsRef.on('child_added', (snapshot) => { const reportId = snapshot.key; const report = snapshot.val(); playSound(); const lat = report.location.lat; const lng = report.location.lng; const accuracy = report.location.accuracy; const item = document.createElement('div'); item.className = 'report-item'; item.id = `item-${reportId}`; item.innerHTML = `<div class="coords">Lat: ${lat.toFixed(5)}, Lng: ${lng.toFixed(5)}</div><div class="meta accuracy-info">Accuracy: ±${Math.round(accuracy)}m</div><div class="meta">Received: ${new Date(report.createdAt).toLocaleString()}</div><div class="meta" id="updated-${reportId}"></div>`; reportList.prepend(item); const marker = L.marker([lat, lng]).addTo(map); marker.bindPopup(`<b>SOS Alert</b><br>Accuracy: ±${Math.round(accuracy)}m`); markers[reportId] = marker; const circle = L.circle([lat, lng], { radius: accuracy, color: '#ef4444', fillColor: '#ef4444', fillOpacity: 0.15 }).addTo(map); accuracyCircles[reportId] = circle; map.fitBounds(circle.getBounds(), { padding: [50, 50] }); updateUI(); item.addEventListener('click', () => { map.fitBounds(accuracyCircles[reportId].getBounds(), { padding: [50, 50] }); marker.openPopup(); }); });
        reportsRef.on('child_changed', (snapshot) => { const reportId = snapshot.key; const report = snapshot.val(); if (markers[reportId]) { const lat = report.location.lat; const lng = report.location.lng; const accuracy = report.location.accuracy; const newLatLng = [lat, lng]; markers[reportId].setLatLng(newLatLng); accuracyCircles[reportId].setLatLng(newLatLng).setRadius(accuracy); const item = document.getElementById(`item-${reportId}`); item.querySelector('.coords').textContent = `Lat: ${lat.toFixed(5)}, Lng: ${lng.toFixed(5)}`; item.querySelector('.accuracy-info').textContent = `Accuracy: ±${Math.round(accuracy)}m`; const updatedAtEl = document.getElementById(`updated-${reportId}`); if (report.updatedAt) { updatedAtEl.textContent = `Updated: ${new Date(report.updatedAt).toLocaleString()}`; } } });
        reportsRef.on('child_removed', (snapshot) => { const reportId = snapshot.key; if (markers[reportId]) { map.removeLayer(markers[reportId]); delete markers[reportId]; map.removeLayer(accuracyCircles[reportId]); delete accuracyCircles[reportId]; const item = document.getElementById(`item-${reportId}`); if (item) item.remove(); updateUI(); } });
        clearButton.addEventListener('click', () => { if (confirm('Are you sure you want to remove all SOS reports?')) { reportsRef.set(null); } });
    </script>
</body>
</html>